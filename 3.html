<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Witch Fairy - No Asset Error</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.60.0/phaser.min.js"></script>
    <style>
        body { margin: 0; padding: 0; background-color: #4488aa; overflow: hidden; }
        canvas { display: block; }
    </style>
</head>
<body>
<script>
const config = {
    type: Phaser.AUTO,
    width: window.innerWidth,
    height: window.innerHeight,
    backgroundColor: '#4488aa',
    physics: {
        default: 'arcade',
        arcade: { gravity: { y: 0 }, debug: false }
    },
    scene: { create, update }
};

const game = new Phaser.Game(config);

let wizard, keys, cursors;
let spells, enemies, particles;
let score = 0, scoreText, bgIslands;
let enemySpeed = 200;
let spawnDelay = 1000;
let isGameOver = false;

function create() {
    const g = this.make.graphics({ x: 0, y: 0, add: false });
    g.fillStyle(0x4b0082, 1);
    g.fillTriangle(32, 64, 8, 32, 56, 32);
    g.fillStyle(0xffddcc, 1);
    g.fillCircle(32, 24, 10);
    g.fillStyle(0x000000, 1);
    g.fillCircle(28, 24, 2);
    g.fillCircle(36, 24, 2);
    g.fillTriangle(32, 0, 18, 20, 46, 20);
    g.fillRect(18, 20, 28, 6);
    g.fillStyle(0xaa00ff, 1);
    g.fillRect(22, 22, 20, 3);
    g.generateTexture('player', 64, 64);

    const island = this.make.graphics({ x: 0, y: 0, add: false });
    island.fillStyle(0x6e4f32, 1);
    island.fillTriangle(0, 100, 50, 0, 100, 100);
    island.fillStyle(0x228b22, 1);
    island.fillEllipse(50, 10, 40, 20);
    island.generateTexture('island', 100, 100);

    const fire = this.make.graphics({ x: 0, y: 0, add: false });
    fire.fillStyle(0xffaa00, 1);
    fire.fillCircle(10, 10, 10);
    fire.generateTexture('fire', 20, 20);

    const ufo = this.make.graphics({ x: 0, y: 0, add: false });
    ufo.fillStyle(0x888888, 1);
    ufo.fillEllipse(25, 15, 50, 20);
    ufo.fillStyle(0x00ffff, 1);
    ufo.fillCircle(25, 10, 10);
    ufo.generateTexture('enemy', 50, 30);

    bgIslands = this.add.tileSprite(0, config.height - 100, config.width, 100, 'island').setOrigin(0);

    wizard = this.physics.add.sprite(150, config.height / 2, 'player');
    wizard.setCollideWorldBounds(true);

    spells = this.physics.add.group();
    enemies = this.physics.add.group();

    particles = this.add.particles('fire');

    this.enemyTimer = this.time.addEvent({
        delay: spawnDelay,
        loop: true,
        callback: spawnEnemy,
        callbackScope: this
    });

    this.diffTimer = this.time.addEvent({
        delay: 10000,
        loop: true,
        callback: increaseDifficulty,
        callbackScope: this
    });

    keys = this.input.keyboard.addKeys('W,A,S,D');
    cursors = this.input.keyboard.createCursorKeys();

    this.input.on('pointerdown', shoot, this);
    this.input.keyboard.on('keydown-SPACE', shoot, this);

    this.physics.add.overlap(spells, enemies, hitEnemy, null, this);
    this.physics.add.overlap(wizard, enemies, gameOver, null, this);

    scoreText = this.add.text(20, 20, 'Score: 0', {
        fontSize: '28px',
        fill: '#fff',
        fontStyle: 'bold'
    });
}

function spawnEnemy() {
    if (isGameOver) return;
    const y = Phaser.Math.Between(50, config.height - 150);
    const enemy = enemies.create(config.width + 50, y, 'enemy');
    enemy.setVelocityX(-enemySpeed);
}

function increaseDifficulty() {
    enemySpeed += 50;
    spawnDelay = Math.max(300, spawnDelay - 150);
    this.enemyTimer.remove(false);
    this.enemyTimer = this.time.addEvent({
        delay: spawnDelay,
        loop: true,
        callback: spawnEnemy,
        callbackScope: this
    });
}

function update() {
    if (isGameOver) return;

    bgIslands.tilePositionX += 3;

    let vx = 0, vy = 0;
    const speed = 300;

    if (keys.A.isDown || cursors.left.isDown) vx = -1;
    if (keys.D.isDown || cursors.right.isDown) vx = 1;
    if (keys.W.isDown || cursors.up.isDown) vy = -1;
    if (keys.S.isDown || cursors.down.isDown) vy = 1;

    const len = Math.hypot(vx, vy);
    if (len > 0) {
        vx = (vx / len) * speed;
        vy = (vy / len) * speed;
    }

    wizard.setVelocity(vx, vy);

    enemies.getChildren().forEach(e => {
        e.setVelocityX(-enemySpeed);
        if (e.x < -60) e.destroy();
    });

    spells.getChildren().forEach(b => {
        if (b.x > config.width + 50) b.destroy();
    });
}

function shoot() {
    if (isGameOver) return;
    const fire = spells.create(wizard.x + 30, wizard.y, 'fire');
    fire.setVelocityX(600);

    particles.createEmitter({
        speed: 30,
        scale: { start: 0.5, end: 0 },
        lifespan: 200,
        follow: fire
    });
}

function hitEnemy(fire, enemy) {
    fire.destroy();
    enemy.destroy();
    score += 10;
    scoreText.setText('Score: ' + score);
}

function gameOver() {
    if (isGameOver) return;
    isGameOver = true;

    this.physics.pause();
    this.enemyTimer.remove(false);
    this.diffTimer.remove(false);

    wizard.setAlpha(0.5);

    this.add.text(config.width / 2, config.height / 2, 'GAME OVER\nTap to Restart', {
        fontSize: '48px',
        fill: '#fff',
        align: 'center'
    }).setOrigin(0.5);

    this.input.once('pointerdown', () => location.reload());
}
</script>
</body>
</html>